<link rel="import" href="../../../components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../components/paper-button/paper-button.html">
<link rel="import" href="../../../components/iron-icons/iron-icons.html">
<link rel="import" href="../../../components/iron-icons/maps-icons.html">
<link rel="import" href="../../../components/paper-material/paper-material.html">
<link rel="import" href="../../../components/paper-input/paper-input.html">
<link rel="import" href="../../../components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../../../components/paper-radio-group/paper-radio-group.html">

<link rel="import" href="./ts-question-group.html">


<dom-module id="ts-questionnaire">

    <style>
    
        :host {
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            margin-top: 60px;  /* 60px is the green header */
            height: calc(100% - 60px);
            background-color: var(--card-background-color);
        }

        .questions {
            flex: 1 1 auto;
            padding: 0 4rem;
            overflow-y: auto;
        }

        .actions {
            flex: 0 0 62px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-top: 1px solid var(--border-color);
        }

        .actions paper-button {
            display: flex;
            align-items: center;
            min-width: 0;
        }

        .actions div {
            display: flex;
            flex-direction: row;
        }

        .btn-submit {
            color: var(--reverse-text-color);
            background-color: var(--primary-color);
        }

        .btn-submit[disabled] {
            color: var(--disabled-text);
            background-color: var(--disabled-button-bg);
        }

        .btn-submit, .btn-cancel {
            margin: 0 0.5rem;
        }

    </style>

    <template>

        <div class="questions">
            <neon-animated-pages selected="{{step}}">
                <template is="dom-repeat" items="[[questions]]" as="group">
                    <ts-question-group class="question-group" selected="{{step}}" group="{{group}}"></ts-question-group>
                </template>
            </neon-animated-pages>
        </div>

        <div class="actions">
            <paper-button class="btn btn-previous" on-tap="previous" disabled$="{{firstStep}}">
                <iron-icon class="icn icn-prev" icon="icons:chevron-left"></iron-icon>
            </paper-button>
            <div>
                <paper-button class="btn btn-cancel" raised on-tap="cancel">Cancel</paper-button>
                <paper-button class="btn btn-submit" raised on-tap="submit" disabled$="{{!lastStep}}">Submit</paper-button>
            </div>
            <paper-button class="btn btn-next" on-tap="next" disabled$="{{lastStep}}">
                <iron-icon class="icn icn-next" icon="icons:chevron-right"></iron-icon>
            </paper-button>
        </div>

    </template>

</dom-module>


<script>

    Polymer({

        is: 'ts-questionnaire',

        behaviors: [
            Polymer.IronResizableBehavior,
            Polymer.NeonAnimatableBehavior
        ],

        properties: {
            selected: {
                type: Number,
                value: 0,
                notify: true
            },
            newdata: {
                type: Object,
                value: {},
                notify: true
            },
            importdata: {
                type: Object,
                value: {},
                notify: true
            },
            questions: {
                type: Array,
                value: []
            },
            step: {
                type: Number,
                value: 0
            },
            firstStep: {
                type: Boolean,
                value: true
            },
            lastStep: {
                type: Boolean,
                value: false
            }
        },

        ready: function() {
            this.questions = App.questionnaire.questions;
        },

        cancel: function () {
            this.set('selected', 0);
        },

        next: function() {
            (this.validate() && !this._isLastStep()) && this._updateSteps(true);
        },

        previous: function() {
            !this._isFirstStep() && this._updateSteps(false);
        },

        validate: function() {
            return this.querySelector('.question-group.iron-selected').validate();
        },

        _updateSteps: function(forward) {
            forward ? this.step++ : this.step--;
            this.set('firstStep', this._isFirstStep());
            this.set('lastStep', this._isLastStep());
        },

        _isLastStep: function() {
            return this.step === (this.questions.length - 1);
        },

        _isFirstStep: function() {
            return this.step === 0;
        }

    });

</script>